<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
	 <link href='http://fonts.googleapis.com/css?family=Quicksand:300' rel='stylesheet' type='text/css'>
	 <link href='http://fonts.googleapis.com/css?family=Josefin+Slab:100|Alegreya+Sans:100' rel='stylesheet' type='text/css'>
      <style type="text/css">
	
    h1 {
    	text-align: center;
    	font-family: 'Josefin Slab', serif;
    	font-size: 300%;
    	padding-top: 60px;
    	color: #222;
  
    }	
    .button{
    	position: relative;
    	font-family:'Quicksand', sans-serif;
    	font-size: 12px;
    }
    #p1{
    	text-align: center;
    	padding-bottom: 30px;
    }
    .axis path, 
	.axis line{
		fill: none; 
		stroke: black;
		shape-rendering: crispEdges;
	}
	.axis text{
		font-family: sans-serif;
		font-size: 11px;
	}
	.circle:hover{
		fill: orange;
		r: 6;
	}
    </style>
    	<h1>Pretty Chart</h1>
</head>	
<body>

	<p id="p1">
		<strong style="display: block">
		<button id="barGraph" class="button"> Bar Graph</button>
		<button id="scatter" class="button">Scatterplot</button></strong>
	<strong style="display: block">
		<button id= "newdata" class="button"> New Data </button>
		<button id="sort" class="button"> Sort</button>
		<button id="adddata" class="button"> Add Entry</button>
		<button id="removedata" class="button"> Remove Entry</button></strong>

	</p>
	<script type="text/javascript">
		var barGraph = true;
		var scatterP = false;
		var w = 600;
		var h = 250;
		var padding = 30;
		var barPadding = 1; 
		var maxValue = 50;
		var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13, 11, 12, 15, 20, 18, 17, 16,  18, 23, 25 ];
		var colors = ["#AE2B3D", "#115ABC", "#4208A1", "#00A24F", "#00A24F", "#F7C019", "#ED8C18"]
   		var color = [];
   		var xAxis;
   		var yAxis;
   		var circleX;
   		var circleY;
		for(var i = 0; i< dataset.length; i++){
			color.push(colors[Math.floor(Math.random()*7)])
		}
		xScale = d3.scale.ordinal()
							.domain(d3.range(dataset.length))
							.rangeRoundBands([0, w], .05);
		yScale = d3.scale.linear()
							.domain([0, d3.max(dataset)+5])
							.range([0, h]);

		var svg = d3.select("#p1")
				    .append("svg")
				    .attr("align", "center")
				    .attr("width", w)
				    .attr("height", h);
var makeBar = function(){
		d3.selectAll("rect")
				.transition()
				.duration(500)
				.attr("y", h+100)
				.remove()
		d3.selectAll("text")
				.transition()
				.duration(1000)
				.attr("y", h+100)
				.remove()
		d3.selectAll("circle")
				.transition()
				.duration(1000)
				.attr("cy", h+100)
				.remove()
		d3.selectAll("line")
				.transition()
				.duration(1000)
				.attr("transform", "translate(" + padding + ", " + h + "100)")
				.remove()
		d3.selectAll("path")
				.transition()
				.duration(1000)
				.attr("transform", "translate(" + padding + ", " + h + "100)")
				.remove()
				barGraph = true
				scatterP = false
		xScale = d3.scale.ordinal()
							.domain(d3.range(dataset.length))
							.rangeRoundBands([0, w], .05);
		yScale = d3.scale.linear()
							.domain([0, d3.max(dataset)+5])
							.range([0, h]);

		svg.selectAll("#opacRec")
			.data(dataset)
			.enter()
			.append("rect")
			.attr("id", "opacRec")
			.attr("x", function(d, i){
				return xScale(i);
			} )
			.attr("y", function(d){
				return h + yScale(d); 
			})
			.attr("width", xScale.rangeBand())
			.attr("height", function(d){
				return yScale(d);
			})
			.attr("fill", function(d, i){
				return color[i]
			})
			.attr("opacity", .18)
			.transition()
			.duration(1500)
			.attr("y", function(d){
				return h - yScale(d); 
			})
		svg.selectAll("#bars")
			.data(dataset)
			.enter()
			.append("rect")
			.attr("id", "bars")
			.attr("x", function(d, i){
				return xScale(i);
			})
			.attr("y", function(d){
				return h + yScale(d) - 2; })
			.attr("width", xScale.rangeBand())
			.attr("height", 4)
			.attr("fill", function(d, i){
				return color[i]
			})
			.transition()
			.duration(1500)
			.attr("y", function(d){
				return h - yScale(d) - 2; })
		
		svg.selectAll("#label")
			.data(dataset)
			.enter()
			.append("text")
			.text(function(d){
				return d;
			})
			.attr("x", function(d, i){
				return xScale(i) + xScale.rangeBand()/2;
			} )
			.attr("y", function(d){
				return h + 100; 
			})
			.attr("font-family", "Quicksand, sans-serif")
			.attr("font-size", "13px")
			.attr("fill", "#222")
			.attr("text-anchor", "middle")
			.attr("id", "label")
			.transition()
			.duration(1500)
			.attr("y", function(d){
				return h - yScale(d) - 5; 
			})
		}

		makeBar()
		d3.select("#barGraph").on("click", function(){
			makeBar()
		})

		var button = d3.select("#newdata")
					.on("click", function(){
						var numValues = dataset.length;              
						dataset = [];                                       
						for (var i = 0; i < numValues; i++) {               
    						var newNumber = Math.floor(Math.random() * maxValue); 
    						dataset.push(newNumber);                        
						}
						yScale.domain([0, d3.max(dataset)+5]);

						if(barGraph){
            			svg.selectAll("#opacRec")
            				.data(dataset)
            				.transition()
            				.duration(1000)
            				.attr("y", function(d){
								return h - yScale(d); 
							})
            				.attr("height", function(d){
								return yScale(d);});
            			svg.selectAll("text")
            				.data(dataset)
            				.transition()
            				.duration(1000)
            				.text(function(d){
            					return d;
            				})
            				.attr("x", function(d, i){
								return xScale(i) + xScale.rangeBand()/2;
							})
							.attr("y", function(d){
								return h - yScale(d) - 5; 
							});
						svg.selectAll("#bars")
								.data(dataset)
								.transition()
								.duration(1000)
								.attr("y", function(d){
									return h - yScale(d) - 2; })
						}
						else if (scatterP){
							circleY.domain([0, d3.max(dataset)+5])
							svg.selectAll("circle")
								.data(dataset)
								.transition()
								.duration(1000)
								.attr("cy", function(d){
										return circleY(d);
								})

							svg.select(".x.axis")
								.transition()
								.duration(1000)
								.call(xAxis)
							svg.select(".y.axis")
								.transition()
								.duration(1000)
								.call(yAxis)
	
						}
					});

		var sortOrder = false; 
		function numberAs(a,b) {
  				return a-b;}
  		 function numberDes(a,b) {
   			return b-a;}

		var sortBars = function(){
			sortOrder = !sortOrder
			if(barGraph){
			svg.selectAll("#opacRec")
				.sort(function(a, b){
					if(sortOrder){
						dataset = dataset.sort(numberAs)
						return d3.ascending(a, b);}
					else{
						dataset = dataset.sort(numberDes)
						return d3.descending(a, b);}})
				.transition()
				.delay(function(d, i) {
        		return i * 50;
				})
				.duration(1000)
				.attr("x", function(d, i){ return xScale(i);})
			svg.selectAll("#bars")
					.sort(function(a, b){
						if(sortOrder){
							return d3.ascending(a, b);
						}else{
							return d3.descending(a,b);
						}})
					.transition()	
					.delay(function(d, i){
						return i * 50;
					})
					.duration(1000)
					.attr("width", xScale.rangeBand())
					.attr("x", function(d, i){
						return xScale(i);
			});
			svg.selectAll("text")
				.sort(function(a, b){
					if(sortOrder){
						return d3.ascending(a, b);}
					else{
						return d3.descending(a, b);}})
				.transition()
				.delay(function(d, i) {
       			return i * 50;
				})
				.duration(1000)
				.attr("x", function(d, i){
					return xScale(i) + xScale.rangeBand()/2;})
				.attr("y", function(d){
					return h - yScale(d) -5;});
			}
			if(scatterP){	
				svg.selectAll("circle")
				.sort(function(a, b){
					if(sortOrder){
						dataset = dataset.sort(numberAs)
						return d3.ascending(a, b);}
					else{
						dataset = dataset.sort(numberDes)
						return d3.descending(a, b);}})

				.transition()
				.duration(1000)
				.each("start", function(){
					d3.select(this)
						.attr("fill", "#AE2B3D")
						.attr("opacity", .18)
						
						.attr("r", 8);
				})
				.attr("cx", function(d, i){ return circleX(i);})
				.attr("cy", function(d){ return circleY(d)})
				.transition()
				.duration(1000)
				.attr("fill", "#AE2B3D")
				.attr("opacity", 1)
				.attr("stroke-width", 0)
				.attr("r", 3.5)
				
				
			}

		};
		d3.select("#sort").on("click", function(){
			sortBars();
		});
		var addRemoveData = function(action){
			if(action == "add"){
			var num = Math.floor(Math.random()*25)
			dataset.push(num)
			color.push(colors[Math.floor(Math.random()*7)])
			}else{
				dataset.pop()
			}
			

			if(barGraph){	
			xScale.domain(d3.range(dataset.length))	
			yScale.domain([0, d3.max(dataset)+5])		
			var bars = svg.selectAll("#opacRec").data(dataset);

            bars.enter()
            	.append("rect")
            	.attr("id", "opacRec")
            	.attr("x", w)
            	.attr("y", function(d){
            		return h - yScale(d);
            	})
            	.attr("width", xScale.rangeBand())
            	.attr("height", function(d){
					return yScale(d);})
            	.attr("fill", function(d, i){
            		return color[i];
            	})
            	.attr("opacity", .18)

            	bars.transition()
            		.duration(1000)
            		.attr("x", function(d, i){
            			return xScale(i);
            		})
            		.attr("y", function(d){
            			return h-yScale(d);
            		})
            		.attr("width", xScale.rangeBand())
            		.attr("height", function(d){
            			return yScale(d);})
            	
            	bars.exit()
            		.transition()
            		.duration(1800)
            		.attr("y", -h)
            		.remove();

            var text = svg.selectAll("text").data(dataset);
				
            text.enter()
            	.append("text")
            	.text(function(d){
					return d;
				})
            	.attr("x", w+10)
            	.attr("y", function(d){
					return h - yScale(d) - 5;})
            	.attr("font-family", "Quicksand, sans-serif")
				.attr("font-size", "13px")
				.attr("fill", "#222")
				.attr("text-anchor", "middle")
				.attr("id", "label")
            text.transition()
            	.duration(1000)
            	.attr("x", function(d, i){
					return xScale(i) + xScale.rangeBand()/2;})
            	.attr("y", function(d){
				return h - yScale(d) - 5;})
			text.exit()
            	.transition()
            	.duration(1800)
            	.attr("y", -h)
            	.remove();
			var topbar = svg.selectAll("#bars").data(dataset);
			topbar.enter()
				.append("rect")
				.attr("id", "bars")
				.attr("x", w)
				.attr("y", function(d){
            		return h - yScale(d)-2;
            	})
            	.attr("width", xScale.rangeBand())
            	.attr("height", 4)
            	.attr("fill", function(d, i){
            		return color[i];
            	})
			topbar.transition()
				.duration(1000)
				.attr("x", function(d, i){
					return xScale(i);
						})
				.attr("y", function(d){
            			return h -yScale(d) - 2;
            		})
            	.attr("width", xScale.rangeBand())
            	.attr("height", 4)
            	if(dataset.length > 30){
            		svg.selectAll("text")
            		.attr("font-size", "11px")
            	}
            topbar.exit()
            	.transition()
            	.duration(1800)
            	.attr("y", -h)
            	.remove();
            }
            else if(scatterP){
            		circleX = d3.scale.linear()
   						.domain([0, dataset.length])
						.range([padding, w-padding*2]);
		            circleY= d3.scale.linear()
						 .domain([0, d3.max(dataset)])
						 .range([h-padding, padding]);
            var circles = svg.selectAll("circle").data(dataset)
            circles.enter()
            	.append("circle")
            	.attr("fill", "#AE2B3D")
            	.attr("r", 3)
            	.attr("cx", w + 50)
            	.attr("cy", function(d){ return circleY(d)})
            circles.transition()
            	.duration(1000)
            	.attr("cx", function(d, i){ return circleX(i)})
            	.attr("cy", function(d){ return circleY(d)})
            circles.exit()
            		.transition()
            		.duration(1800)
            		.attr("cy", -h)
            		.remove();
            xAxis = d3.svg.axis()
		           xAxis.scale(circleX)
			.orient("bottom")
			.ticks(5);
	         yAxis = d3.svg.axis()
					  .scale(circleY)
					  .orient("left")
					  .ticks(5);
            svg.select(".x.axis")
					.transition()
					.duration(1000)
					.call(xAxis)
			svg.select(".y.axis")
					.transition()
					.duration(1000)
					.call(yAxis)

            }

		}
		d3.select("#adddata").on("click", function(){
			addRemoveData("add");
		});

		d3.select("#removedata").on("click", function(){
			addRemoveData("remove");
		})

	var scatterPlot = function(){
			d3.selectAll("rect")
				.transition()
				.duration(500)
				.attr("y", h+100)
				.remove()
			d3.selectAll("text")
				.transition()
				.duration(500)
				.attr("y", h+100)
				.remove()
			barGraph = false;
			scatterP = true;
		circleX = d3.scale.linear()
   						.domain([0, dataset.length])
						.range([padding, w-padding*2]);
		circleY = d3.scale.linear()
						 .domain([0, d3.max(dataset)])
						 .range([h-padding, padding]);
	xAxis = d3.svg.axis()
		xAxis.scale(circleX)
			.orient("bottom")
			.ticks(5);
	yAxis = d3.svg.axis()
					  .scale(circleY)
					  .orient("left")
					  .ticks(5);
              
		svg.selectAll("circle")
			.data(dataset)
			.enter()
			.append("circle")
			.transition()
				.duration(1000)
				.each("start", function(){
					d3.select(this)
						.attr("fill", "#AE2B3D")
						.attr("opacity", .18)
						.attr("cx", w + 50)
						.attr("cy", function(d){
							return circleY(d);
						})
						.attr("r", 8);
				})
				.attr("cx", function(d, i){ return circleX(i);})
				.attr("cy", function(d){ return circleY(d)})
				.transition()
				.duration(500)
				.attr("fill", "#AE2B3D")
				.attr("opacity", 1)
				.attr("stroke-width", 0)
				.attr("r", 3.5)
		svg.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(0, " + h + ")")
			.transition()
			.duration(1000)
			.attr("transform", "translate(0, " + (h - padding) + ")")
			.call(xAxis);
		svg.append("g")
			.attr("class", "y axis")
			.transition()
			.duration(1000)
			.attr("transform", "translate(" + padding + ", 0)")
			.call(yAxis);

				
				

		}


		d3.select("#scatter").on("click", function(){
			scatterPlot();
		})
	</script>	
</body>
</html>